(()=>{var e={};e.id=4042,e.ids=[4042],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,r,s)=>{"use strict";s.d(r,{e:()=>n});let t=s(46101).createPool({host:process.env.MYSQL_HOST||"localhost",user:process.env.MYSQL_USER||"root",password:process.env.MYSQL_PASSWORD||"",database:process.env.MYSQL_DATABASE||"facebook_clone",waitForConnections:!0,connectionLimit:10,queueLimit:0});async function n({query:e,values:r}){try{if(!r||0===r.length){let[r]=await t.query(e);return r}let[s]=await t.execute(e,r);return s}catch(e){throw console.error("Database query error:",e),e}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,s)=>{"use strict";s.d(r,{N:()=>u});var t=s(13581),n=s(85665),i=s.n(n),a=s(5069);let u={providers:[(0,t.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await (0,a.e)({query:"SELECT * FROM users WHERE email = ?",values:[e.email]});if(0===r.length)return null;let s=r[0];if(!await i().compare(e.password,s.password))return null;return{id:s.id,name:`${s.first_name} ${s.last_name}`,email:s.email,image:s.profile_picture,username:s.username}}catch(e){return console.error("Authentication error:",e),null}}})],callbacks:{jwt:async({token:e,user:r,trigger:s,session:t})=>(r&&(e.id=r.id,e.username=r.username),"update"===s&&t?.image&&(e.picture=t.image),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id,e.user.username=r.username,r.picture&&(e.user.image=r.picture)),e)},pages:{signIn:"/auth/signin",signOut:"/auth/signout",error:"/auth/error",newUser:"/auth/register"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,domain:".gaanlagbe.com"}}},secret:process.env.NEXTAUTH_SECRET,debug:!1}},13581:(e,r)=>{"use strict";r.A=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},19771:e=>{"use strict";e.exports=require("process")},23870:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var t=s(55511);let n={randomUUID:t.randomUUID},i=new Uint8Array(256),a=i.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let o=function(e,r,s){if(n.randomUUID&&!r&&!e)return n.randomUUID();let o=(e=e||{}).random??e.rng?.()??(a>i.length-16&&((0,t.randomFillSync)(i),a=0),i.slice(a,a+=16));if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,r){if((s=s||0)<0||s+16>r.length)throw RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[s+e]=o[e];return r}return function(e,r=0){return(u[e[r+0]]+u[e[r+1]]+u[e[r+2]]+u[e[r+3]]+"-"+u[e[r+4]]+u[e[r+5]]+"-"+u[e[r+6]]+u[e[r+7]]+"-"+u[e[r+8]]+u[e[r+9]]+"-"+u[e[r+10]]+u[e[r+11]]+u[e[r+12]]+u[e[r+13]]+u[e[r+14]]+u[e[r+15]]).toLowerCase()}(o)}},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=28303,e.exports=r},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96173:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>q,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>x});var t={};s.r(t),s.d(t,{GET:()=>p,POST:()=>f});var n=s(96559),i=s(48088),a=s(37719),u=s(32190),o=s(35426),d=s(12909),l=s(23870),c=s(5069);async function p(e){try{let e=await (0,o.getServerSession)(d.N);if(!e?.user?.id)return u.NextResponse.json({message:"Unauthorized"},{status:401});let r=await (0,c.e)({query:`
        SELECT
          f.*,
          u.id as user_id, u.username, u.first_name, u.last_name, u.profile_picture
        FROM friendships f
        JOIN users u ON f.requester_id = u.id
        WHERE f.addressee_id = ? AND f.status = 'pending'
        ORDER BY f.created_at DESC
      `,values:[e.user.id]});return u.NextResponse.json({friendRequests:r})}catch(e){return console.error("Error fetching friend requests:",e),u.NextResponse.json({message:"Internal server error"},{status:500})}}async function f(e){try{let r=await (0,o.getServerSession)(d.N);if(!r?.user?.id)return u.NextResponse.json({message:"Unauthorized"},{status:401});let{addresseeId:s}=await e.json();if(!s)return u.NextResponse.json({message:"Addressee ID is required"},{status:400});let t=await (0,c.e)({query:"SELECT * FROM users WHERE id = ?",values:[s]});if(0===t.length)return u.NextResponse.json({message:"User not found"},{status:404});let n=await (0,c.e)({query:`
        SELECT * FROM friendships
        WHERE (requester_id = ? AND addressee_id = ?)
           OR (requester_id = ? AND addressee_id = ?)
      `,values:[r.user.id,s,s,r.user.id]});if(n.length>0){let e=n[0];if("pending"===e.status)return u.NextResponse.json({message:"Friend request already sent or received"},{status:400});if("accepted"===e.status)return u.NextResponse.json({message:"Already friends"},{status:400});if("blocked"===e.status)return u.NextResponse.json({message:"Unable to send friend request"},{status:400})}let i=(0,l.A)();await (0,c.e)({query:`
        INSERT INTO friendships (
          id, requester_id, addressee_id, status
        ) VALUES (?, ?, ?, 'pending')
      `,values:[i,r.user.id,s]});let a=(0,l.A)();return await (0,c.e)({query:`
        INSERT INTO notifications (
          id, user_id, sender_id, type, reference_id
        ) VALUES (?, ?, ?, 'friend_request', ?)
      `,values:[a,s,r.user.id,i]}),u.NextResponse.json({message:"Friend request sent successfully"},{status:201})}catch(e){return console.error("Error sending friend request:",e),u.NextResponse.json({message:"Internal server error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/friends/requests/route",pathname:"/api/friends/requests",filename:"route",bundlePath:"app/api/friends/requests/route"},resolvedPagePath:"C:\\Users\\mrihr\\Desktop\\hifnf_nextjs_mysql\\src\\app\\api\\friends\\requests\\route.ts",nextConfigOutput:"standalone",userland:t}),{workAsyncStorage:g,workUnitAsyncStorage:x,serverHooks:q}=m;function h(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:x})}},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4243,8203,2190,5426,5665],()=>s(96173));module.exports=t})();