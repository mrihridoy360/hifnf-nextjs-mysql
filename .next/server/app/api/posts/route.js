(()=>{var e={};e.id=4607,e.ids=[4607],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5069:(e,r,s)=>{"use strict";s.d(r,{e:()=>i});let t=s(46101).createPool({host:process.env.MYSQL_HOST||"localhost",user:process.env.MYSQL_USER||"root",password:process.env.MYSQL_PASSWORD||"",database:process.env.MYSQL_DATABASE||"facebook_clone",waitForConnections:!0,connectionLimit:10,queueLimit:0});async function i({query:e,values:r}){try{if(!r||0===r.length){let[r]=await t.query(e);return r}let[s]=await t.execute(e,r);return s}catch(e){throw console.error("Database query error:",e),e}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,s)=>{"use strict";s.d(r,{N:()=>a});var t=s(13581),i=s(85665),n=s.n(i),o=s(5069);let a={providers:[(0,t.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await (0,o.e)({query:"SELECT * FROM users WHERE email = ?",values:[e.email]});if(0===r.length)return null;let s=r[0];if(!await n().compare(e.password,s.password))return null;return{id:s.id,name:`${s.first_name} ${s.last_name}`,email:s.email,image:s.profile_picture,username:s.username}}catch(e){return console.error("Authentication error:",e),null}}})],callbacks:{jwt:async({token:e,user:r,trigger:s,session:t})=>(r&&(e.id=r.id,e.username=r.username),"update"===s&&t?.image&&(e.picture=t.image),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.id,e.user.username=r.username,r.picture&&(e.user.image=r.picture)),e)},pages:{signIn:"/auth/signin",signOut:"/auth/signout",error:"/auth/error",newUser:"/auth/register"},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,domain:".gaanlagbe.com"}}},secret:process.env.NEXTAUTH_SECRET,debug:!1}},13581:(e,r)=>{"use strict";r.A=function(e){return{id:"credentials",name:"Credentials",type:"credentials",credentials:{},authorize:()=>null,options:e}}},19771:e=>{"use strict";e.exports=require("process")},23870:(e,r,s)=>{"use strict";s.d(r,{A:()=>u});var t=s(55511);let i={randomUUID:t.randomUUID},n=new Uint8Array(256),o=n.length,a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));let u=function(e,r,s){if(i.randomUUID&&!r&&!e)return i.randomUUID();let u=(e=e||{}).random??e.rng?.()??(o>n.length-16&&((0,t.randomFillSync)(n),o=0),n.slice(o,o+=16));if(u.length<16)throw Error("Random bytes length must be >= 16");if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,r){if((s=s||0)<0||s+16>r.length)throw RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let e=0;e<16;++e)r[s+e]=u[e];return r}return function(e,r=0){return(a[e[r+0]]+a[e[r+1]]+a[e[r+2]]+a[e[r+3]]+"-"+a[e[r+4]]+a[e[r+5]]+"-"+a[e[r+6]]+a[e[r+7]]+"-"+a[e[r+8]]+a[e[r+9]]+"-"+a[e[r+10]]+a[e[r+11]]+a[e[r+12]]+a[e[r+13]]+a[e[r+14]]+a[e[r+15]]).toLowerCase()}(u)}},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=28303,e.exports=r},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37489:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>f,routeModule:()=>S,serverHooks:()=>y,workAsyncStorage:()=>_,workUnitAsyncStorage:()=>E});var t={};s.r(t),s.d(t,{GET:()=>m,POST:()=>g});var i=s(96559),n=s(48088),o=s(37719),a=s(32190),u=s(35426),c=s(12909),l=s(23870),p=s(5069),d=s(81104);async function m(e){try{let r=await (0,u.getServerSession)(c.N),s=r?.user?.id,t=new URL(e.url),i=parseInt(t.searchParams.get("limit")||"10"),n=parseInt(t.searchParams.get("offset")||"0"),o=`
      SELECT
        p.*,
        u.id as author_id,
        u.username,
        u.first_name,
        u.last_name,
        u.profile_picture,
        (SELECT COUNT(*) FROM reactions WHERE post_id = p.id AND reaction_type = 'like') AS likes_count,
        (SELECT COUNT(*) FROM reactions WHERE post_id = p.id AND reaction_type = 'dislike') AS dislikes_count,
        (SELECT COUNT(*) FROM comments WHERE post_id = p.id) AS comments_count,
        ${s?`EXISTS(SELECT 1 FROM reactions WHERE post_id = p.id AND user_id = '${s}' AND reaction_type = 'like')`:"FALSE"} AS liked_by_user,
        ${s?`EXISTS(SELECT 1 FROM reactions WHERE post_id = p.id AND user_id = '${s}' AND reaction_type = 'dislike')`:"FALSE"} AS disliked_by_user,
        ${s?`(SELECT reaction_type FROM reactions WHERE post_id = p.id AND user_id = '${s}')`:"NULL"} AS user_reaction
      FROM posts p
      JOIN users u ON p.user_id = u.id
      ORDER BY p.created_at DESC
      LIMIT ${i} OFFSET ${n}
    `;console.log("Fetching posts with query:",o);let l=await (0,p.e)({query:o,values:[]});return l.length>0&&console.log("First post user profile picture:",l[0].user?.profile_picture),a.NextResponse.json({posts:l})}catch(e){return console.error("Error fetching posts:",e),a.NextResponse.json({message:"Internal server error"},{status:500})}}async function g(e){try{(0,d.H)();let r=await (0,u.getServerSession)(c.N);if(!r?.user?.id)return a.NextResponse.json({message:"Unauthorized"},{status:401});let t=await e.formData(),i=t.get("content"),n=t.get("privacy")||"public",o=t.get("imageUrl"),m=t.get("videoUrl"),g=t.get("feeling"),S=t.get("feelingEmoji"),_=t.get("media");if(!i&&!_&&!o&&!m)return a.NextResponse.json({message:"Post must have content or media"},{status:400});let E=o||null,y=m||null;if(_){let{uploadFile:e}=await s.e(187).then(s.bind(s,62568)),r=await e(_);if(!r.success)return a.NextResponse.json({message:r.error||"Failed to upload media"},{status:400});"image"===r.fileType?E=r.url||null:"video"===r.fileType&&(y=r.url||null)}let f=(0,l.A)();await (0,p.e)({query:`
        INSERT INTO posts (
          id, user_id, content, image_url, video_url, feeling, feeling_emoji, privacy
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
      `,values:[f,r.user.id,i,E,y,g||null,S||null,n]});let x=await (0,p.e)({query:`
        SELECT
          p.*,
          u.id as user_id,
          u.username,
          u.first_name,
          u.last_name,
          u.profile_picture,
          0 AS likes_count,
          0 AS dislikes_count,
          0 AS comments_count,
          FALSE AS liked_by_user,
          FALSE AS disliked_by_user,
          NULL AS user_reaction
        FROM posts p
        JOIN users u ON p.user_id = u.id
        WHERE p.id = ?
      `,values:[f]});return a.NextResponse.json({message:"Post created successfully",post:x[0]},{status:201})}catch(e){return console.error("Error creating post:",e),a.NextResponse.json({message:"Internal server error"},{status:500})}}let S=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"C:\\Users\\mrihr\\Desktop\\hifnf_nextjs_mysql\\src\\app\\api\\posts\\route.ts",nextConfigOutput:"standalone",userland:t}),{workAsyncStorage:_,workUnitAsyncStorage:E,serverHooks:y}=S;function f(){return(0,o.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:E})}},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81104:(e,r,s)=>{"use strict";s.d(r,{H:()=>a});var t=s(29021),i=s.n(t),n=s(33873),o=s.n(n);function a(){try{let e=process.env.UPLOAD_DIR||"public/uploads",r=o().join(process.cwd(),e,"images"),s=o().join(process.cwd(),e,"videos"),t=o().join(process.cwd(),e,"profiles"),n=o().join(process.cwd(),e,"comments");i().existsSync(o().join(process.cwd(),e))||i().mkdirSync(o().join(process.cwd(),e),{recursive:!0}),i().existsSync(r)||i().mkdirSync(r,{recursive:!0}),i().existsSync(s)||i().mkdirSync(s,{recursive:!0}),i().existsSync(t)||i().mkdirSync(t,{recursive:!0}),i().existsSync(n)||i().mkdirSync(n,{recursive:!0})}catch(e){console.error("Error ensuring upload directories exist:",e)}}},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4243,8203,2190,5426,5665],()=>s(37489));module.exports=t})();